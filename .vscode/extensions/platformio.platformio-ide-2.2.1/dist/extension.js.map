{"version":3,"sources":["webpack://platformio-ide/./src/constants.js","webpack://platformio-ide/./src/home.js","webpack://platformio-ide/./src/installer/manager.js","webpack://platformio-ide/./src/installer/python-prompt.js","webpack://platformio-ide/./src/main.js","webpack://platformio-ide/./src/misc.js","webpack://platformio-ide/./src/project.js","webpack://platformio-ide/./src/state-storage.js","webpack://platformio-ide/./src/tasks/manager.js","webpack://platformio-ide/./src/tasks/project.js","webpack://platformio-ide/./src/tasks/tree-view.js","webpack://platformio-ide/./src/terminal.js","webpack://platformio-ide/./src/utils.js","webpack://platformio-ide/./src/views/quick-access-tree.js","webpack://platformio-ide/external \"fs\"","webpack://platformio-ide/external \"fs-plus\"","webpack://platformio-ide/external \"os\"","webpack://platformio-ide/external \"path\"","webpack://platformio-ide/external \"platformio-node-helpers\"","webpack://platformio-ide/external \"platformio-vscode-debug\"","webpack://platformio-ide/external \"vscode\"","webpack://platformio-ide/webpack/bootstrap","webpack://platformio-ide/webpack/startup"],"names":["IS_WINDOWS","process","platform","startsWith","IS_OSX","pioNodeHelpers","PIOHome","constructor","this","subscriptions","_currentPanel","undefined","_lastStartUrl","defaultStartUrl","push","vscode","workspace","onDidChangeWorkspaceFolders","disposePanel","bind","startUrl","column","window","activeTextEditor","viewColumn","webview","html","getWebviewContent","reveal","err","console","warn","newPanel","panel","createWebviewPanel","extension","getEnterpriseSetting","ViewColumn","One","enableScripts","retainContextWhenHidden","onDidDispose","onPanelDisposed","iconPath","Uri","file","path","join","context","extensionPath","getLoadingContent","toString","includes","notifyError","getTheme","getConfiguration","colorTheme","toLowerCase","params","home","ensureServerStarted","port","getSetting","onIDECommand","async","command","workspaceFolders","updateWorkspaceFolders","length","uri","commands","executeCommand","editor","showTextDocument","gotoPosition","Position","line","selection","Selection","revealRange","Range","TextEditorRevealType","InCenter","theme","getFrontendUri","host","start","dispose","misc","disposeSubscriptions","shutdownServer","globalState","disableAutoUpdates","LOCK_TIMEOUT","LOCK_KEY","STORAGE_STATE_KEY","stateStorage","StateStorage","config","stages","installer","PlatformIOCoreStage","onDidStatusChange","pioCoreVersionSpec","PIO_CORE_VERSION_SPEC","useBuiltinPython","get","useBuiltinPIOCore","useDevelopmentPIOCore","pythonPrompt","PythonPrompt","locked","lock","update","Date","getTime","unlock","lockTime","parseInt","result","stage","check","progress","stageIncrementTotal","install","message","increment","report","destroy","map","STATUS_TRY_AGAIN","STATUS_ABORT","STATUS_CUSTOMEXE","selectedItem","showInformationMessage","title","isCloseAffordance","parse","status","pythonExecutable","showInputBox","prompt","placeHolder","validateInput","value","fs","isFileSync","activate","deactivate","piodebug","utils","pioTerm","pioHome","_enterpriseSettings","projectManager","ProjectManager","PIOTerminal","hasPIOProject","getActivePIOProjectDir","has","patchOSEnviron","startInstaller","handleUseDevelopmentPIOCoreConfiguration","registerTreeDataProvider","QuickAccessTreeProvider","registerGlobalCommands","TaskManager","initDebug","initToolbar","ignoreCommands","initIndexer","autoRebuild","startPIOHome","maybeRateExtension","warnAboutConflictedExtensions","onDidChangeActiveTextEditor","warnAboutInoFile","filterCommands","id","loadEnterpriseSettings","ext","extensions","all","find","item","isActive","exports","settings","defaultValue","extraVars","PLATFORMIO_IDE","getIDEVersion","http_proxy","env","HTTP_PROXY","HTTPS_PROXY","https_proxy","proc","caller","extraPath","im","InstallationManager","withProgress","location","ProgressLocation","Window","Notification","outputChannel","createOutputChannel","show","appendLine","action","showAtStartup","registerCommand","toggle","new","sendText","filter","reverse","forEach","index","text","tooltip","sbItem","createStatusBarItem","StatusBarAlignment","Left","STATUS_BAR_PRIORITY_START","onDidChangeConfiguration","e","affectsConfiguration","envDir","core","getEnvDir","isDirectorySync","setTimeout","removeSync","disposeLocalSubscriptions","stateKey","state","getValue","done","callCounter","setValue","conflicted","CONFLICTED_EXTENSION_IDS","showWarningMessage","packageJSON","displayName","document","fileName","endsWith","_lastActiveProjectDir","_selectedProjectEnv","_indexObsorver","projectDir","accessSync","getSelectedProjectEnv","setSelectedProjectEnv","envName","projectIndexer","getProjectIndexer","setActiveEnv","rebuild","getPIOProjectDirs","folder","fsPath","dir","isPIOProjectSync","pioProjectDirs","resource","scheme","getWorkspaceFolder","options","project","ProjectObserver","ide","createFileSystemWatcher","createDirSystemWatcher","task","viewId","doUpdate","rebuildIndex","_globalState","_stateKey","_loadState","key","data","_ptm","onDidProjectTasksRefresh","checkActiveProjectDir","ProjectTaskManager","requestRefresh","_sid","Math","random","_refreshTimeout","_envTasks","_sbEnvSwitcher","clearTimeout","refresh","AUTO_REFRESH_DELAY","envs","loadProjectEnvs","envTasks","getEnvTasks","taskViewer","createTreeView","TASKS_VIEW_ID","treeDataProvider","ProjectTasksTreeProvider","showCollapseAll","onDidExpandElement","element","onDidLoadEnvTasks","substring","tasks","registerTaskProvider","type","provideTasks","Object","values","toVSCodeTask","resolveTask","addProjectConfigWatcher","controlDeviceMonitorTasks","registerTaskBasedCommands","registerEnvSwitcher","prevCWD","cwd","chdir","ProjectConfig","read","name","selectedEnv","pt","ProjectTasks","Default","getDefaultTasks","fetchEnvTasks","projectTask","envClone","create","PLATFORMIO_PATH","PATH","Path","vscodeTask","Task","ProcessExecution","args","presentationOptions","TaskPanelKind","Dedicated","isBuild","group","TaskGroup","Build","isClean","Clean","isTest","Test","watcher","onDidCreate","onDidChange","onDidDelete","restoreAfterTask","restoreTasks","onDidStartTaskProcess","event","some","arg","execution","taskExecutions","every","terminate","onDidEndTaskProcess","exitCode","executeTask","switchProjectEnv","items","label","description","pickedItem","showQuickPick","maybeEnvTask","taskName","selectedEnvName","multiEnvProject","keys","getTreeItem","TreeItem","taskToTreeItem","treeItem","ThemeIcon","arguments","coreEnv","multienv","getChildren","getGroupChildren","getEnvChildren","getRootChildren","TreeItemCollapsibleState","Expanded","Collapsed","getTaskGroups","Folder","candidates","_instance","createTerminal","exitStatus","stack","ghbody","version","os","release","arch","reportUrl","getErrorReportUrl","showErrorMessage","error","getIDEManifest","getExtension","QuickItem","collapsibleState","children","super","customChildren","module","require","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__"],"mappings":"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","file":"extension.js","sourcesContent":["/**\n * Copyright (c) 2017-present PlatformIO <contact@platformio.org>\n * All rights reserved.\n *\n * This source code is licensed under the license found in the LICENSE file in\n * the root directory of this source tree.\n */\n\nexport const IS_WINDOWS = process.platform.startsWith('win');\nexport const IS_OSX = process.platform == 'darwin';\nexport const IS_LINUX = !IS_WINDOWS && !IS_OSX;\nexport const PIO_CORE_VERSION_SPEC = '>=5';\nexport const STATUS_BAR_PRIORITY_START = 10;\nexport const CONFLICTED_EXTENSION_IDS = [\n  'llvm-vs-code-extensions.vscode-clangd',\n  'vsciot-vscode.vscode-arduino',\n];\n","/**\n * Copyright (c) 2017-present PlatformIO <contact@platformio.org>\n * All rights reserved.\n *\n * This source code is licensed under the license found in the LICENSE file in\n * the root directory of this source tree.\n */\n\nimport * as pioNodeHelpers from 'platformio-node-helpers';\n\nimport { IS_OSX } from './constants';\nimport { extension } from './main';\nimport { notifyError } from './utils';\nimport path from 'path';\nimport vscode from 'vscode';\n\nexport default class PIOHome {\n  static defaultStartUrl = '/';\n\n  constructor() {\n    this.subscriptions = [];\n    this._currentPanel = undefined;\n    this._lastStartUrl = PIOHome.defaultStartUrl;\n\n    // close PIO Home when workspaces folders are changed (VSCode reactivates extensiuon)\n    this.subscriptions.push(\n      vscode.workspace.onDidChangeWorkspaceFolders(this.disposePanel.bind(this))\n    );\n  }\n\n  async toggle(startUrl = PIOHome.defaultStartUrl) {\n    const column = vscode.window.activeTextEditor\n      ? vscode.window.activeTextEditor.viewColumn\n      : undefined;\n    try {\n      if (this._currentPanel) {\n        if (this._lastStartUrl !== startUrl) {\n          this._currentPanel.webview.html = await this.getWebviewContent(startUrl);\n        }\n        return this._currentPanel.reveal(column);\n      }\n    } catch (err) {\n      console.warn(err);\n    }\n    this._currentPanel = await this.newPanel(startUrl);\n  }\n\n  async newPanel(startUrl) {\n    const panel = vscode.window.createWebviewPanel(\n      'pioHome',\n      extension.getEnterpriseSetting('pioHomeTitle', 'PIO Home'),\n      vscode.ViewColumn.One,\n      {\n        enableScripts: true,\n        retainContextWhenHidden: true,\n      }\n    );\n    this.subscriptions.push(panel.onDidDispose(this.onPanelDisposed.bind(this)));\n    panel.iconPath = vscode.Uri.file(\n      path.join(\n        extension.context.extensionPath,\n        'resources',\n        'platformio-mini-logo.svg'\n      )\n    );\n    panel.webview.html = this.getLoadingContent();\n    try {\n      panel.webview.html = await this.getWebviewContent(startUrl);\n    } catch (err) {\n      if (!err.toString().includes('Webview is disposed')) {\n        notifyError('Start PIO Home Server', err);\n      }\n    }\n    return panel;\n  }\n\n  getTheme() {\n    const workbench = vscode.workspace.getConfiguration('workbench') || {};\n    return (workbench.colorTheme || '').toLowerCase().includes('light')\n      ? 'light'\n      : 'dark';\n  }\n\n  getLoadingContent() {\n    const theme = this.getTheme();\n    return `<!DOCTYPE html>\n    <html lang=\"en\">\n    <body style=\"background-color: ${theme === 'light' ? '#FFF' : '#1E1E1E'}\">\n      <div style=\"padding: 15px;\">Loading...</div>\n    </body>\n    </html>`;\n  }\n\n  async getWebviewContent(startUrl) {\n    this._lastStartUrl = startUrl;\n    const params = await pioNodeHelpers.home.ensureServerStarted({\n      port: extension.getSetting('pioHomeServerHttpPort'),\n      onIDECommand: async (command, params) => {\n        if (command === 'open_project') {\n          this.disposePanel();\n          if (vscode.workspace.workspaceFolders) {\n            vscode.workspace.updateWorkspaceFolders(\n              vscode.workspace.workspaceFolders.length,\n              null,\n              { uri: vscode.Uri.file(params) }\n            );\n          } else {\n            vscode.commands.executeCommand(\n              'vscode.openFolder',\n              vscode.Uri.file(params)\n            );\n          }\n          vscode.commands.executeCommand('workbench.view.explorer');\n        } else if (command === 'open_text_document') {\n          const editor = await vscode.window.showTextDocument(\n            vscode.Uri.file(params.path)\n          );\n          const gotoPosition = new vscode.Position(\n            (params.line || 1) - 1,\n            (params.column || 1) - 1\n          );\n          editor.selection = new vscode.Selection(gotoPosition, gotoPosition);\n          editor.revealRange(\n            new vscode.Range(gotoPosition, gotoPosition),\n            vscode.TextEditorRevealType.InCenter\n          );\n        }\n      },\n    });\n    const theme = this.getTheme();\n    return `<!DOCTYPE html>\n      <html lang=\"en\">\n      <head>\n        <script>\n          window.addEventListener('message', (e) => {\n            switch (e.data.command) {\n              case 'kbd-event': {\n                if (${IS_OSX}) {\n                  window.dispatchEvent(new KeyboardEvent('keydown', e.data.data));\n                }\n                break;\n              }\n            }\n          }, false);\n        </script>\n      </head>\n      <body style=\"margin: 0; padding: 0; height: 100%; overflow: hidden; background-color: ${\n        theme === 'light' ? '#FFF' : '#1E1E1E'\n      }\">\n        <iframe src=\"${pioNodeHelpers.home.getFrontendUri(params.host, params.port, {\n          start: startUrl,\n          theme,\n          workspace: extension.getEnterpriseSetting('defaultPIOHomeWorkspace'),\n        })}\"\n          width=\"100%\"\n          height=\"100%\"\n          frameborder=\"0\"\n          style=\"border: 0; left: 0; right: 0; bottom: 0; top: 0; position:absolute;\" />\n      </body>\n      </html>\n    `;\n  }\n\n  onPanelDisposed() {\n    this._currentPanel = undefined;\n  }\n\n  disposePanel() {\n    if (!this._currentPanel) {\n      return;\n    }\n    this._currentPanel.dispose();\n    this._currentPanel = undefined;\n  }\n\n  dispose() {\n    this.disposePanel();\n    pioNodeHelpers.misc.disposeSubscriptions(this.subscriptions);\n    pioNodeHelpers.home.shutdownServer();\n  }\n}\n","/**\n * Copyright (c) 2017-present PlatformIO <contact@platformio.org>\n * All rights reserved.\n *\n * This source code is licensed under the license found in the LICENSE file in\n * the root directory of this source tree.\n */\n\nimport * as pioNodeHelpers from 'platformio-node-helpers';\n\nimport { PIO_CORE_VERSION_SPEC } from '../constants';\nimport PythonPrompt from './python-prompt';\nimport StateStorage from '../state-storage';\nimport vscode from 'vscode';\n\nexport default class InstallationManager {\n  LOCK_TIMEOUT = 1 * 60 * 1000; // 1 minute\n  LOCK_KEY = 'platformio-ide:installer-lock';\n  STORAGE_STATE_KEY = 'platformio-ide:installer-state';\n\n  constructor(globalState, disableAutoUpdates = false) {\n    this.globalState = globalState;\n    this.stateStorage = new StateStorage(globalState, this.STORAGE_STATE_KEY);\n\n    const config = vscode.workspace.getConfiguration('platformio-ide');\n    this.stages = [\n      new pioNodeHelpers.installer.PlatformIOCoreStage(\n        this.stateStorage,\n        this.onDidStatusChange.bind(this),\n        {\n          pioCoreVersionSpec: PIO_CORE_VERSION_SPEC,\n          useBuiltinPython: config.get('useBuiltinPython'),\n          useBuiltinPIOCore: config.get('useBuiltinPIOCore'),\n          useDevelopmentPIOCore: config.get('useDevelopmentPIOCore'),\n          pythonPrompt: new PythonPrompt(),\n          disableAutoUpdates: disableAutoUpdates,\n        }\n      ),\n    ];\n  }\n\n  onDidStatusChange() {\n    // increase lock timeout on each stage update\n    if (this.locked()) {\n      this.lock();\n    }\n  }\n\n  lock() {\n    return this.globalState.update(this.LOCK_KEY, new Date().getTime());\n  }\n\n  unlock() {\n    return this.globalState.update(this.LOCK_KEY, undefined);\n  }\n\n  locked() {\n    const lockTime = this.globalState.get(this.LOCK_KEY);\n    if (!lockTime) {\n      return false;\n    }\n    return new Date().getTime() - parseInt(lockTime) <= this.LOCK_TIMEOUT;\n  }\n\n  async check() {\n    let result = true;\n    for (const stage of this.stages) {\n      try {\n        if (!(await stage.check())) {\n          result = false;\n        }\n      } catch (err) {\n        result = false;\n        console.warn(err);\n      }\n    }\n    return result;\n  }\n\n  async install(progress) {\n    const stageIncrementTotal = 100 / this.stages.length;\n    for (const stage of this.stages) {\n      await stage.install((message, increment) => {\n        progress.report({\n          message,\n          increment: stageIncrementTotal * (increment / 100),\n        });\n      });\n    }\n    progress.report({ message: 'Finish! Please restart VSCode.', increment: 100 });\n  }\n\n  destroy() {\n    return this.stages.map((stage) => stage.destroy());\n  }\n}\n","/**\n * Copyright (c) 2017-present PlatformIO <contact@platformio.org>\n * All rights reserved.\n *\n * This source code is licensed under the license found in the LICENSE file in\n * the root directory of this source tree.\n */\n\nimport fs from 'fs-plus';\nimport vscode from 'vscode';\n\nexport default class PythonPrompt {\n  STATUS_TRY_AGAIN = 0;\n  STATUS_ABORT = 1;\n  STATUS_CUSTOMEXE = 2;\n\n  async prompt() {\n    const selectedItem = await vscode.window.showInformationMessage(\n      'PlatformIO: Can not find working Python 2.7 or 3.5+ Interpreter. Please install the latest Python 3 and restart VSCode',\n      { title: 'Install Python', isCloseAffordance: false },\n      { title: 'I have Python', isCloseAffordance: false },\n      { title: 'Try again', isCloseAffordance: false },\n      { title: 'Abort PlatformIO IDE Installation', isCloseAffordance: true }\n    );\n\n    switch (selectedItem ? selectedItem.title : undefined) {\n      case 'Install Python':\n        vscode.commands.executeCommand(\n          'vscode.open',\n          vscode.Uri.parse(\n            'http://docs.platformio.org/page/faq.html#install-python-interpreter'\n          )\n        );\n        return { status: this.STATUS_TRY_AGAIN };\n      case 'I have Python':\n        return {\n          status: this.STATUS_CUSTOMEXE,\n          pythonExecutable: await vscode.window.showInputBox({\n            prompt: 'Please specify a full path to Python executable file',\n            placeHolder: 'Full path to python/python.exe',\n            validateInput: (value) =>\n              !fs.isFileSync(value) ? 'Invalid path to Python Interpreter' : null,\n          }),\n        };\n      case 'Abort PlatformIO IDE Installation':\n        return { status: this.STATUS_ABORT };\n      default:\n        return { status: this.STATUS_TRY_AGAIN };\n    }\n  }\n}\n","/**\n * Copyright (c) 2017-present PlatformIO <contact@platformio.org>\n * All rights reserved.\n *\n * This source code is licensed under the license found in the LICENSE file in\n * the root directory of this source tree.\n */\n\nimport * as misc from './misc';\nimport * as pioNodeHelpers from 'platformio-node-helpers';\nimport * as piodebug from 'platformio-vscode-debug';\nimport * as utils from './utils';\n\nimport InstallationManager from './installer/manager';\nimport PIOHome from './home';\nimport PIOTerminal from './terminal';\nimport ProjectManager from './project';\nimport QuickAccessTreeProvider from './views/quick-access-tree';\nimport { STATUS_BAR_PRIORITY_START } from './constants';\nimport StateStorage from './state-storage';\nimport TaskManager from './tasks/manager';\nimport fs from 'fs-plus';\nimport vscode from 'vscode';\n\nclass PlatformIOVSCodeExtension {\n  constructor() {\n    this.context = undefined;\n    this.pioTerm = undefined;\n    this.pioHome = undefined;\n    this.subscriptions = [];\n\n    this._enterpriseSettings = undefined;\n  }\n\n  async activate(context) {\n    this.context = context;\n    this.stateStorage = new StateStorage(context.globalState);\n    this.projectManager = new ProjectManager();\n    this.pioHome = new PIOHome();\n    this.pioTerm = new PIOTerminal();\n\n    this.subscriptions.push(this.projectManager, this.pioHome, this.pioTerm);\n\n    const hasPIOProject = !!this.projectManager.getActivePIOProjectDir();\n    if (!hasPIOProject && this.getSetting('activateOnlyOnPlatformIOProject')) {\n      return;\n    }\n\n    // temporary workaround for https://github.com/Microsoft/vscode/issues/58348\n    if (\n      !vscode.workspace\n        .getConfiguration('extensions')\n        .has('showRecommendationsOnlyOnDemand')\n    ) {\n      vscode.workspace\n        .getConfiguration('extensions')\n        .update('showRecommendationsOnlyOnDemand', true);\n    }\n\n    this.patchOSEnviron();\n    await this.startInstaller(!hasPIOProject);\n    this.subscriptions.push(this.handleUseDevelopmentPIOCoreConfiguration());\n\n    vscode.commands.executeCommand('setContext', 'pioCoreReady', true);\n    if (typeof this.getEnterpriseSetting('onPIOCoreReady') === 'function') {\n      await this.getEnterpriseSetting('onPIOCoreReady')();\n    }\n\n    this.subscriptions.push(\n      vscode.window.registerTreeDataProvider(\n        'platformio-activitybar.quickAccess',\n        new QuickAccessTreeProvider()\n      )\n    );\n\n    this.registerGlobalCommands();\n\n    if (!hasPIOProject) {\n      this.initToolbar({ filterCommands: ['platformio-ide.showHome'] });\n      return;\n    }\n\n    vscode.commands.executeCommand('setContext', 'pioProjectReady', true);\n\n    this.subscriptions.push(new TaskManager());\n    this.initDebug();\n    this.initToolbar({\n      ignoreCommands: this.getEnterpriseSetting('ignoreToolbarCommands'),\n    });\n    this.projectManager.initIndexer({\n      autoRebuild: this.getSetting('autoRebuildAutocompleteIndex'),\n    });\n\n    this.startPIOHome();\n\n    misc.maybeRateExtension(this.stateStorage);\n    misc.warnAboutConflictedExtensions();\n    this.subscriptions.push(\n      vscode.window.onDidChangeActiveTextEditor((editor) =>\n        misc.warnAboutInoFile(editor, this.stateStorage)\n      )\n    );\n  }\n\n  getSetting(id) {\n    return vscode.workspace.getConfiguration('platformio-ide').get(id);\n  }\n\n  loadEnterpriseSettings() {\n    const ext = vscode.extensions.all.find(\n      (item) =>\n        item.id.startsWith('platformio.') &&\n        item.id !== 'platformio.platformio-ide' &&\n        item.isActive\n    );\n    return ext && ext.exports ? ext.exports.settings : undefined;\n  }\n\n  getEnterpriseSetting(id, defaultValue = undefined) {\n    if (!this._enterpriseSettings) {\n      this._enterpriseSettings = this.loadEnterpriseSettings();\n    }\n    if (this._enterpriseSettings && id in this._enterpriseSettings) {\n      return this._enterpriseSettings[id];\n    }\n    return defaultValue;\n  }\n\n  patchOSEnviron() {\n    const extraVars = {\n      PLATFORMIO_IDE: utils.getIDEVersion(),\n    };\n    // handle HTTP proxy settings\n    const http_proxy = vscode.workspace.getConfiguration('http').get('proxy');\n    if (http_proxy && !process.env.HTTP_PROXY && !process.env.http_proxy) {\n      extraVars['HTTP_PROXY'] = http_proxy;\n    }\n    if (!vscode.workspace.getConfiguration('http').get('proxyStrictSSL')) {\n      // https://stackoverflow.com/questions/48391750/disable-python-requests-ssl-validation-for-an-imported-module\n      extraVars['CURL_CA_BUNDLE'] = '';\n    }\n    if (http_proxy && !process.env.HTTPS_PROXY && !process.env.https_proxy) {\n      extraVars['HTTPS_PROXY'] = http_proxy;\n    }\n    pioNodeHelpers.proc.patchOSEnviron({\n      caller: 'vscode',\n      extraPath: this.getSetting('customPATH'),\n      extraVars,\n    });\n  }\n\n  async startInstaller(disableAutoUpdates) {\n    const im = new InstallationManager(this.context.globalState, disableAutoUpdates);\n    if (im.locked()) {\n      vscode.window.showInformationMessage(\n        'PlatformIO IDE installation has been suspended, because PlatformIO ' +\n          'IDE Installer is already started in another window.'\n      );\n      return;\n    }\n    const doInstall = await vscode.window.withProgress(\n      {\n        location: vscode.ProgressLocation.Window,\n        title: 'PlatformIO',\n      },\n      async (progress) => {\n        progress.report({\n          message: 'Checking PlatformIO Core installation...',\n        });\n        try {\n          return !(await im.check());\n        } catch (err) {}\n        return true;\n      }\n    );\n\n    if (!doInstall) {\n      return;\n    }\n\n    return await vscode.window.withProgress(\n      {\n        location: vscode.ProgressLocation.Notification,\n        title: 'PlatformIO Installer',\n      },\n      async (progress) => {\n        progress.report({\n          message: 'Installing PlatformIO IDE...',\n        });\n        const outputChannel = vscode.window.createOutputChannel(\n          'PlatformIO Installation'\n        );\n        outputChannel.show();\n        outputChannel.appendLine('Installing PlatformIO IDE...');\n        outputChannel.appendLine(\n          'It may take a few minutes depending on your connection speed'\n        );\n        outputChannel.appendLine(\n          'Please do not close this window and do not ' +\n            'open other folders until this process is completed.'\n        );\n        outputChannel.appendLine(\n          '\\nDebugging information is available via VSCode > Help > Toggle Developer Tools > Console.'\n        );\n\n        try {\n          im.lock();\n          await im.install(progress);\n          outputChannel.appendLine('PlatformIO IDE installed successfully.\\n');\n          outputChannel.appendLine('Please restart VSCode.');\n          const action = 'Reload Now';\n          const selected = await vscode.window.showInformationMessage(\n            'PlatformIO IDE has been successfully installed! Please reload window',\n            action\n          );\n          if (selected === action) {\n            vscode.commands.executeCommand('workbench.action.reloadWindow');\n          }\n        } catch (err) {\n          outputChannel.appendLine('Failed to install PlatformIO IDE.');\n          utils.notifyError('Installation Manager', err);\n        } finally {\n          im.unlock();\n        }\n\n        im.destroy();\n        return true;\n      }\n    );\n  }\n\n  async startPIOHome() {\n    if (\n      this.getSetting('disablePIOHomeStartup') ||\n      !pioNodeHelpers.home.showAtStartup('vscode')\n    ) {\n      return;\n    }\n    vscode.commands.executeCommand('platformio-ide.showHome');\n  }\n\n  registerGlobalCommands() {\n    this.subscriptions.push(\n      vscode.commands.registerCommand('platformio-ide.showHome', (startUrl) =>\n        this.pioHome.toggle(startUrl)\n      ),\n      vscode.commands.registerCommand('platformio-ide.newTerminal', () =>\n        this.pioTerm.new().show()\n      ),\n      vscode.commands.registerCommand('platformio-ide.openPIOCoreCLI', () =>\n        this.pioTerm.sendText('pio --help')\n      ),\n      vscode.commands.registerCommand('platformio-ide.startDebugging', () => {\n        vscode.commands.executeCommand('workbench.view.debug');\n        vscode.commands.executeCommand('workbench.debug.action.toggleRepl');\n        vscode.commands.executeCommand('workbench.action.debug.start');\n      }),\n      vscode.commands.registerCommand('platformio-ide.updateGlobalLibs', () =>\n        this.pioTerm.sendText('pio lib --global update')\n      ),\n      vscode.commands.registerCommand('platformio-ide.updatePlatforms', () =>\n        this.pioTerm.sendText('pio platform update')\n      ),\n      vscode.commands.registerCommand('platformio-ide.updateCore', () =>\n        this.pioTerm.sendText('pio update')\n      ),\n      vscode.commands.registerCommand('platformio-ide.upgradeCore', () =>\n        this.pioTerm.sendText('pio upgrade')\n      )\n    );\n  }\n\n  initDebug() {\n    piodebug.activate(this.context);\n  }\n\n  initToolbar({ filterCommands, ignoreCommands }) {\n    if (this.getSetting('disableToolbar')) {\n      return;\n    }\n    [\n      ['$(home)', 'PlatformIO: Home', 'platformio-ide.showHome'],\n      ['$(check)', 'PlatformIO: Build', 'platformio-ide.build'],\n      ['$(arrow-right)', 'PlatformIO: Upload', 'platformio-ide.upload'],\n      ['$(trashcan)', 'PlatformIO: Clean', 'platformio-ide.clean'],\n      ['$(plug)', 'PlatformIO: Serial Monitor', 'platformio-ide.serialMonitor'],\n      ['$(terminal)', 'PlatformIO: New Terminal', 'platformio-ide.newTerminal'],\n    ]\n      .filter(\n        (item) =>\n          (!filterCommands || filterCommands.includes(item[2])) &&\n          (!ignoreCommands || !ignoreCommands.includes(item[2]))\n      )\n      .reverse()\n      .forEach((item, index) => {\n        const [text, tooltip, command] = item;\n        const sbItem = vscode.window.createStatusBarItem(\n          vscode.StatusBarAlignment.Left,\n          STATUS_BAR_PRIORITY_START + index + 1\n        );\n        sbItem.text = text;\n        sbItem.tooltip = tooltip;\n        sbItem.command = command;\n        sbItem.show();\n        this.subscriptions.push(sbItem);\n      });\n  }\n\n  handleUseDevelopmentPIOCoreConfiguration() {\n    return vscode.workspace.onDidChangeConfiguration((e) => {\n      if (\n        !e.affectsConfiguration('platformio-ide.useDevelopmentPIOCore') ||\n        !this.getSetting('useBuiltinPIOCore')\n      ) {\n        return;\n      }\n      const envDir = pioNodeHelpers.core.getEnvDir();\n      if (!envDir || !fs.isDirectorySync(envDir)) {\n        return;\n      }\n      pioNodeHelpers.home.shutdownServer();\n      const delayedJob = () => {\n        try {\n          fs.removeSync(envDir);\n        } catch (err) {\n          console.warn(err);\n        }\n        vscode.window.showInformationMessage(\n          'Please restart VSCode to apply the changes.'\n        );\n      };\n      setTimeout(delayedJob, 2000);\n    });\n  }\n\n  disposeLocalSubscriptions() {\n    vscode.commands.executeCommand('setContext', 'pioCoreReady', false);\n    pioNodeHelpers.misc.disposeSubscriptions(this.subscriptions);\n  }\n\n  deactivate() {\n    this.disposeLocalSubscriptions();\n  }\n}\n\nexport const extension = new PlatformIOVSCodeExtension();\n\nexport function activate(context) {\n  extension.activate(context);\n  return extension;\n}\n\nexport function deactivate() {\n  extension.deactivate();\n  piodebug.deactivate();\n}\n","/**\n * Copyright (c) 2017-present PlatformIO <contact@platformio.org>\n * All rights reserved.\n *\n * This source code is licensed under the license found in the LICENSE file in\n * the root directory of this source tree.\n */\n\nimport { CONFLICTED_EXTENSION_IDS } from './constants';\nimport vscode from 'vscode';\n\nexport async function maybeRateExtension(stateStorage) {\n  const stateKey = 'rate-extension';\n  const askAfterSessionNums = 13;\n  let state = stateStorage.getValue(stateKey);\n  if (state && state.done) {\n    return;\n  } else if (!state || !state.callCounter) {\n    state = {\n      callCounter: 0,\n      done: false,\n    };\n  }\n\n  state.callCounter += 1;\n  if (state.callCounter < askAfterSessionNums) {\n    stateStorage.setValue(stateKey, state);\n    return;\n  }\n\n  const selectedItem = await vscode.window.showInformationMessage(\n    'If you enjoy using PlatformIO IDE for VSCode, would you mind taking a moment to rate it? ' +\n      'It will not take more than one minute. Thanks for your support!',\n    { title: 'Rate PlatformIO IDE Extension', isCloseAffordance: false },\n    { title: 'Remind later', isCloseAffordance: false },\n    { title: 'No, Thanks', isCloseAffordance: true }\n  );\n\n  switch (selectedItem ? selectedItem.title : undefined) {\n    case 'Rate PlatformIO IDE Extension':\n      vscode.commands.executeCommand(\n        'vscode.open',\n        vscode.Uri.parse('http://bit.ly/pio-vscode-rate')\n      );\n      state.done = true;\n      break;\n    case 'No, Thanks':\n      state.done = true;\n      break;\n    default:\n      state.callCounter = 0;\n  }\n  stateStorage.setValue(stateKey, state);\n}\n\nexport async function warnAboutConflictedExtensions() {\n  const conflicted = vscode.extensions.all.filter(\n    (ext) => ext.isActive && CONFLICTED_EXTENSION_IDS.includes(ext.id)\n  );\n  if (conflicted.length === 0) {\n    return;\n  }\n  const selectedItem = await vscode.window.showWarningMessage(\n    `Conflicted extensions with IntelliSense service were detected (${conflicted\n      .map((ext) => ext.packageJSON.displayName || ext.id)\n      .join(', ')}). ` +\n      'Code-completion, linting and navigation will not work properly. ' +\n      'Please disable or uninstall them (Menu > View > Extensions).',\n    { title: 'More details', isCloseAffordance: false },\n    { title: 'Uninstall conflicted', isCloseAffordance: false },\n    { title: 'Remind later', isCloseAffordance: true }\n  );\n  switch (selectedItem ? selectedItem.title : undefined) {\n    case 'More details':\n      vscode.commands.executeCommand(\n        'vscode.open',\n        vscode.Uri.parse('http://bit.ly/pio-vscode-conflicted-extensions')\n      );\n      break;\n    case 'Uninstall conflicted':\n      conflicted.forEach((ext) => {\n        vscode.commands.executeCommand(\n          'workbench.extensions.uninstallExtension',\n          ext.id\n        );\n      });\n      vscode.commands.executeCommand('workbench.action.reloadWindow');\n      break;\n  }\n}\n\nexport async function warnAboutInoFile(editor, stateStorage) {\n  if (!editor || !editor.document || !editor.document.fileName) {\n    return;\n  }\n  if (!editor.document.fileName.endsWith('.ino')) {\n    return;\n  }\n  const stateKey = 'ino-warn-disabled';\n  if (stateStorage.getValue(stateKey)) {\n    return;\n  }\n\n  const selectedItem = await vscode.window.showWarningMessage(\n    'C/C++ IntelliSense service does not support .INO files. ' +\n      'It might lead to the spurious problems with code completion, linting, and debugging. ' +\n      'Please convert .INO sketch into the valid .CPP file.',\n    { title: 'Show instruction', isCloseAffordance: false },\n    { title: 'Do not show again', isCloseAffordance: false },\n    { title: 'Remind later', isCloseAffordance: true }\n  );\n  switch (selectedItem ? selectedItem.title : undefined) {\n    case 'Show instruction':\n      vscode.commands.executeCommand(\n        'vscode.open',\n        vscode.Uri.parse('http://bit.ly/ino2cpp')\n      );\n      break;\n    case 'Do not show again':\n      stateStorage.setValue(stateKey, 1);\n      break;\n  }\n}\n","/**\n * Copyright (c) 2017-present PlatformIO <contact@platformio.org>\n * All rights reserved.\n *\n * This source code is licensed under the license found in the LICENSE file in\n * the root directory of this source tree.\n */\n\nimport * as pioNodeHelpers from 'platformio-node-helpers';\n\nimport fs from 'fs';\nimport path from 'path';\nimport vscode from 'vscode';\n\nexport default class ProjectManager {\n  constructor() {\n    this.subscriptions = [];\n    this._lastActiveProjectDir = undefined;\n    this._selectedProjectEnv = {};\n    this._indexObsorver = undefined;\n  }\n\n  static isPIOProjectSync(projectDir) {\n    try {\n      fs.accessSync(path.join(projectDir, 'platformio.ini'));\n      return true;\n    } catch (err) {}\n    return false;\n  }\n\n  getSelectedProjectEnv(projectDir) {\n    return this._selectedProjectEnv[projectDir];\n  }\n\n  setSelectedProjectEnv(projectDir, envName) {\n    if (this._selectedProjectEnv[projectDir] && !envName) {\n      delete this._selectedProjectEnv[projectDir];\n    }\n    this._selectedProjectEnv[projectDir] = envName;\n    if (this._indexObsorver) {\n      const projectIndexer = this._indexObsorver.getProjectIndexer(projectDir);\n      projectIndexer.setActiveEnv(envName);\n      projectIndexer.rebuild();\n    }\n  }\n\n  getPIOProjectDirs() {\n    return (vscode.workspace.workspaceFolders || [])\n      .map((folder) => folder.uri.fsPath)\n      .filter((dir) => ProjectManager.isPIOProjectSync(dir));\n  }\n\n  getActivePIOProjectDir() {\n    const pioProjectDirs = this.getPIOProjectDirs();\n    if (pioProjectDirs.length < 1) {\n      this._lastActiveProjectDir = undefined;\n      return this._lastActiveProjectDir;\n    }\n    if (\n      !this._lastActiveProjectDir ||\n      !vscode.workspace.workspaceFolders.find(\n        (folder) => folder.uri.fsPath === this._lastActiveProjectDir\n      )\n    ) {\n      this._lastActiveProjectDir = pioProjectDirs[0];\n    }\n    const editor = vscode.window.activeTextEditor;\n    if (!editor) {\n      return this._lastActiveProjectDir;\n    }\n    const resource = editor.document.uri;\n    if (resource.scheme !== 'file') {\n      return this._lastActiveProjectDir;\n    }\n    const folder = vscode.workspace.getWorkspaceFolder(resource);\n    if (!folder || !ProjectManager.isPIOProjectSync(folder.uri.fsPath)) {\n      // outside workspace\n      return this._lastActiveProjectDir;\n    }\n    this._lastActiveProjectDir = folder.uri.fsPath;\n    return this._lastActiveProjectDir;\n  }\n\n  initIndexer(options = {}) {\n    this._indexObsorver = new pioNodeHelpers.project.ProjectObserver({\n      ide: 'vscode',\n      createFileSystemWatcher: vscode.workspace.createFileSystemWatcher,\n      createDirSystemWatcher: (dir) =>\n        vscode.workspace.createFileSystemWatcher(path.join(dir, '*')),\n      withProgress: (task) =>\n        vscode.window.withProgress(\n          {\n            location: { viewId: vscode.ProgressLocation.Window },\n            title: 'PlatformIO: IntelliSense Index Rebuild',\n          },\n          task\n        ),\n    });\n\n    const doUpdate = () => {\n      this._indexObsorver.update(\n        options.autoRebuild && vscode.workspace.workspaceFolders\n          ? vscode.workspace.workspaceFolders.map((folder) => folder.uri.fsPath)\n          : []\n      );\n    };\n\n    this.subscriptions.push(\n      this._indexObsorver,\n      vscode.workspace.onDidChangeWorkspaceFolders(doUpdate.bind(this)),\n      vscode.workspace.onDidChangeConfiguration(doUpdate.bind(this)),\n      vscode.commands.registerCommand('platformio-ide.rebuildProjectIndex', () => {\n        doUpdate(); // re-scan PIO Projects\n        this._indexObsorver.rebuildIndex();\n      })\n    );\n    doUpdate();\n  }\n\n  dispose() {\n    pioNodeHelpers.misc.disposeSubscriptions(this.subscriptions);\n    this._indexObsorver = undefined;\n  }\n}\n","/**\n * Copyright (c) 2017-present PlatformIO <contact@platformio.org>\n * All rights reserved.\n *\n * This source code is licensed under the license found in the LICENSE file in\n * the root directory of this source tree.\n */\n\nexport default class StateStorage {\n  constructor(globalState, stateKey = 'miscStates') {\n    this._globalState = globalState;\n    this._stateKey = stateKey;\n  }\n\n  _loadState() {\n    try {\n      const value = this._globalState.get(this._stateKey);\n      return value || {};\n    } catch (err) {\n      return {};\n    }\n  }\n\n  getValue(key) {\n    return (this._loadState() || {})[key];\n  }\n\n  setValue(key, value) {\n    const data = this._loadState();\n    data[key] = value;\n    this._globalState.update(this._stateKey, data);\n  }\n}\n","/**\n * Copyright (c) 2017-present PlatformIO <contact@platformio.org>\n * All rights reserved.\n *\n * This source code is licensed under the license found in the LICENSE file in\n * the root directory of this source tree.\n */\n\nimport * as pioNodeHelpers from 'platformio-node-helpers';\n\nimport ProjectTaskManager from './project';\nimport { extension } from '../main';\nimport vscode from 'vscode';\n\nexport default class TaskManager {\n  constructor() {\n    this.subscriptions = [];\n    this._ptm = undefined;\n\n    this.subscriptions.push(\n      vscode.commands.registerCommand('platformio-ide.refreshProjectTasks', () =>\n        this.onDidProjectTasksRefresh()\n      ),\n      vscode.window.onDidChangeActiveTextEditor(() => this.checkActiveProjectDir()),\n      vscode.workspace.onDidChangeWorkspaceFolders(() => this.checkActiveProjectDir())\n    );\n    // trigger project checking, register VSCode Task provider and View\n    this.checkActiveProjectDir();\n  }\n\n  onDidProjectTasksRefresh() {\n    if (this._ptm) {\n      this._ptm.dispose();\n      this._ptm = undefined;\n    }\n    this.checkActiveProjectDir();\n  }\n\n  checkActiveProjectDir() {\n    const projectDir = extension.projectManager.getActivePIOProjectDir();\n    if (this._ptm && this._ptm.projectDir === projectDir) {\n      return;\n    }\n    if (this._ptm) {\n      this._ptm.dispose();\n      this._ptm = undefined;\n    }\n    if (!projectDir) {\n      return;\n    }\n    this._ptm = new ProjectTaskManager(projectDir);\n    this._ptm.requestRefresh();\n  }\n\n  dispose() {\n    pioNodeHelpers.misc.disposeSubscriptions(this.subscriptions);\n  }\n}\n","/**\n * Copyright (c) 2017-present PlatformIO <contact@platformio.org>\n * All rights reserved.\n *\n * This source code is licensed under the license found in the LICENSE file in\n * the root directory of this source tree.\n */\n\nimport * as pioNodeHelpers from 'platformio-node-helpers';\nimport * as utils from '../utils';\n\nimport { IS_WINDOWS, STATUS_BAR_PRIORITY_START } from '../constants';\nimport ProjectTasksTreeProvider from './tree-view';\nimport { extension } from '../main';\nimport path from 'path';\nimport vscode from 'vscode';\n\nexport default class ProjectTaskManager {\n  static TASKS_VIEW_ID = 'platformio-ide.projectTasks';\n  static AUTO_REFRESH_DELAY = 500; // 0.5 sec\n  static type = 'PlatformIO';\n\n  constructor(projectDir) {\n    this.projectDir = projectDir;\n    this.subscriptions = [];\n    this._sid = Math.random();\n    this._refreshTimeout = undefined;\n    this._envTasks = {};\n    this._sbEnvSwitcher = undefined;\n  }\n\n  requestRefresh() {\n    if (this._refreshTimeout) {\n      clearTimeout(this._refreshTimeout);\n    }\n    this._refreshTimeout = setTimeout(\n      this.refresh.bind(this),\n      ProjectTaskManager.AUTO_REFRESH_DELAY\n    );\n  }\n\n  async refresh() {\n    this.dispose();\n\n    const envs = await this.loadProjectEnvs();\n    const envTasks = await this.getEnvTasks(envs);\n\n    const taskViewer = vscode.window.createTreeView(ProjectTaskManager.TASKS_VIEW_ID, {\n      treeDataProvider: new ProjectTasksTreeProvider(\n        this._sid,\n        envTasks,\n        extension.projectManager.getSelectedProjectEnv(this.projectDir)\n      ),\n      showCollapseAll: true,\n    });\n    this.subscriptions.push(\n      taskViewer,\n      // pre-fetch expanded env tasks\n      taskViewer.onDidExpandElement(async ({ element }) => {\n        if (\n          (element.env || '').includes('env:') &&\n          (await this.onDidLoadEnvTasks(element.env.substring(4)))\n        ) {\n          this.refresh();\n        }\n      }),\n      // register VSCode Task Provider\n      vscode.tasks.registerTaskProvider(ProjectTaskManager.type, {\n        provideTasks: async () => {\n          const result = [];\n          for (const tasks of Object.values(envTasks)) {\n            result.push(...tasks.map((task) => this.toVSCodeTask(task)));\n          }\n          return result;\n        },\n        resolveTask: () => {\n          return undefined;\n        },\n      })\n    );\n\n    this.addProjectConfigWatcher();\n    this.controlDeviceMonitorTasks();\n    this.registerTaskBasedCommands();\n    if (envs.length > 1) {\n      this.registerEnvSwitcher(envs);\n    }\n    vscode.commands.executeCommand('setContext', 'pioMultiEnvProject', envs.length > 1);\n  }\n\n  async loadProjectEnvs() {\n    const result = [];\n    const prevCWD = process.cwd();\n    process.chdir(this.projectDir);\n    try {\n      const config = new pioNodeHelpers.project.ProjectConfig();\n      await config.read(path.join(this.projectDir, 'platformio.ini'));\n      for (const name of config.envs()) {\n        const platform = config.get(`env:${name}`, 'platform');\n        if (!platform) {\n          continue;\n        }\n        result.push({ name, platform });\n      }\n    } catch (err) {\n      console.warn(\n        `Could not parse \"platformio.ini\" file in ${this.projectDir}: ${err}`\n      );\n    }\n    // restore original CWD\n    process.chdir(prevCWD);\n    return result;\n  }\n\n  async getEnvTasks(envs) {\n    const selectedEnv = extension.projectManager.getSelectedProjectEnv(this.projectDir);\n    const pt = new pioNodeHelpers.project.ProjectTasks(this.projectDir, 'vscode');\n    const result = { Default: await pt.getDefaultTasks() };\n    for (const item of envs) {\n      if (\n        !this._envTasks[item.name] &&\n        (extension.getSetting('autoPreloadEnvTasks') ||\n          envs.length === 1 ||\n          item.name === selectedEnv)\n      ) {\n        await this.onDidLoadEnvTasks(item.name);\n      }\n      result[`env:${item.name}`] = this._envTasks[item.name] || [];\n    }\n    return result;\n  }\n\n  async onDidLoadEnvTasks(name) {\n    if (name in this._envTasks) {\n      return;\n    }\n    return await vscode.window.withProgress(\n      {\n        location: { viewId: ProjectTaskManager.TASKS_VIEW_ID },\n      },\n      async () => await this.fetchEnvTasks(name)\n    );\n  }\n\n  async fetchEnvTasks(name) {\n    const pt = new pioNodeHelpers.project.ProjectTasks(this.projectDir, 'vscode');\n    this._envTasks[name] = [];\n    this._envTasks[name] = await pt.fetchEnvTasks(name);\n    return this._envTasks[name];\n  }\n\n  toVSCodeTask(projectTask) {\n    const envClone = Object.create(process.env);\n    if (process.env.PLATFORMIO_PATH) {\n      envClone.PATH = process.env.PLATFORMIO_PATH;\n      envClone.Path = process.env.PLATFORMIO_PATH;\n    }\n    const vscodeTask = new vscode.Task(\n      {\n        type: ProjectTaskManager.type,\n        task: projectTask.id,\n      },\n      vscode.workspace.getWorkspaceFolder(vscode.Uri.file(this.projectDir)),\n      projectTask.title,\n      ProjectTaskManager.type,\n      new vscode.ProcessExecution(IS_WINDOWS ? 'pio.exe' : 'pio', projectTask.args, {\n        cwd: this.projectDir,\n        env: envClone,\n      }),\n      '$platformio'\n    );\n    vscodeTask.presentationOptions = {\n      panel: vscode.TaskPanelKind.Dedicated,\n    };\n    if (projectTask.isBuild()) {\n      vscodeTask.group = vscode.TaskGroup.Build;\n    } else if (projectTask.isClean()) {\n      vscodeTask.group = vscode.TaskGroup.Clean;\n    } else if (projectTask.isTest()) {\n      vscodeTask.group = vscode.TaskGroup.Test;\n    }\n    return vscodeTask;\n  }\n\n  addProjectConfigWatcher() {\n    try {\n      const watcher = vscode.workspace.createFileSystemWatcher(\n        path.join(this.projectDir, 'platformio.ini')\n      );\n      this.subscriptions.push(\n        watcher,\n        watcher.onDidCreate(() => {\n          this.requestRefresh();\n        }),\n        watcher.onDidChange(() => {\n          this.requestRefresh();\n        }),\n        watcher.onDidDelete(() => {\n          this.dispose();\n        })\n      );\n    } catch (err) {\n      utils.notifyError('Project Tasks FileSystemWatcher', err);\n    }\n  }\n\n  controlDeviceMonitorTasks() {\n    let restoreAfterTask = undefined;\n    let restoreTasks = [];\n\n    this.subscriptions.push(\n      vscode.tasks.onDidStartTaskProcess((event) => {\n        if (\n          !vscode.workspace\n            .getConfiguration('platformio-ide')\n            .get('autoCloseSerialMonitor')\n        ) {\n          return;\n        }\n        if (\n          !['upload', 'test'].some((arg) =>\n            event.execution.task.execution.args.includes(arg)\n          )\n        ) {\n          return;\n        }\n        vscode.tasks.taskExecutions.forEach((e) => {\n          if (event.execution.task === e.task) {\n            return;\n          }\n          if (\n            ['device', 'monitor'].every((arg) => e.task.execution.args.includes(arg))\n          ) {\n            restoreTasks.push(e.task);\n          }\n          if (e.task.execution.args.includes('monitor')) {\n            e.terminate();\n          }\n        });\n        restoreAfterTask = event.execution.task;\n      }),\n\n      vscode.tasks.onDidEndTaskProcess((event) => {\n        if (event.execution.task !== restoreAfterTask || event.exitCode !== 0) {\n          return;\n        }\n        setTimeout(() => {\n          restoreTasks.forEach((task) => {\n            vscode.tasks.executeTask(task);\n          });\n          restoreTasks = [];\n        }, parseInt(vscode.workspace.getConfiguration('platformio-ide').get('reopenSerialMonitorDelay')));\n      })\n    );\n  }\n\n  registerEnvSwitcher(envs) {\n    // reset last selected env if it was removed from config\n    let selectedEnv = extension.projectManager.getSelectedProjectEnv(this.projectDir);\n    if (selectedEnv && !envs.some((item) => item.name === selectedEnv)) {\n      selectedEnv = undefined;\n      extension.projectManager.setSelectedProjectEnv(this.projectDir, undefined);\n    }\n\n    this._sbEnvSwitcher = vscode.window.createStatusBarItem(\n      vscode.StatusBarAlignment.Left,\n      STATUS_BAR_PRIORITY_START\n    );\n    this._sbEnvSwitcher.tooltip = 'Switch PlatformIO Project Environment';\n    this._sbEnvSwitcher.command = 'platformio-ide.switchProjectEnv';\n    this._sbEnvSwitcher.text = `$(root-folder) ${\n      selectedEnv ? `env:${selectedEnv}` : 'Default'\n    }`;\n    this._sbEnvSwitcher.show();\n\n    this.subscriptions.push(\n      this._sbEnvSwitcher,\n      vscode.commands.registerCommand('platformio-ide.switchProjectEnv', () =>\n        this.switchProjectEnv(envs)\n      )\n    );\n  }\n\n  async switchProjectEnv(envs) {\n    const items = [\n      {\n        label: 'Default',\n        description:\n          'All or \"default_envs\" declared in [platformio] section of \"platformio.ini\"',\n      },\n    ];\n    items.push(...envs.map((env) => ({ label: `env:${env.name}` })));\n    const pickedItem = await vscode.window.showQuickPick(items);\n    if (!pickedItem) {\n      return;\n    }\n    const envName =\n      pickedItem.label === 'Default' ? undefined : pickedItem.label.substring(4);\n    if (envName) {\n      this._sbEnvSwitcher.text = '$(root-folder) Loading...';\n      await this.onDidLoadEnvTasks(envName);\n    }\n    extension.projectManager.setSelectedProjectEnv(this.projectDir, envName);\n    vscode.commands.executeCommand('platformio-ide.refreshProjectTasks');\n  }\n\n  registerTaskBasedCommands() {\n    const maybeEnvTask = (name) => {\n      const selectedEnv = extension.projectManager.getSelectedProjectEnv(\n        this.projectDir\n      );\n      return selectedEnv ? `${name} (${selectedEnv})` : name;\n    };\n\n    this.subscriptions.push(\n      vscode.commands.registerCommand('platformio-ide.build', () => {\n        const taskName = extension.getSetting('buildTask') || {\n          type: ProjectTaskManager.type,\n          task: maybeEnvTask('Build'),\n        };\n        return vscode.commands.executeCommand(\n          'workbench.action.tasks.runTask',\n          taskName\n        );\n      }),\n      vscode.commands.registerCommand('platformio-ide.upload', () =>\n        vscode.commands.executeCommand('workbench.action.tasks.runTask', {\n          type: ProjectTaskManager.type,\n          task: maybeEnvTask(\n            extension.getSetting('forceUploadAndMonitor')\n              ? 'Upload and Monitor'\n              : 'Upload'\n          ),\n        })\n      ),\n      vscode.commands.registerCommand('platformio-ide.remote', () =>\n        vscode.commands.executeCommand('workbench.action.tasks.runTask', {\n          type: ProjectTaskManager.type,\n          task: maybeEnvTask('Remote'),\n        })\n      ),\n      vscode.commands.registerCommand('platformio-ide.test', () =>\n        vscode.commands.executeCommand('workbench.action.tasks.runTask', {\n          type: ProjectTaskManager.type,\n          task: maybeEnvTask('Test'),\n        })\n      ),\n      vscode.commands.registerCommand('platformio-ide.clean', () =>\n        vscode.commands.executeCommand('workbench.action.tasks.runTask', {\n          type: ProjectTaskManager.type,\n          task: maybeEnvTask('Clean'),\n        })\n      ),\n      vscode.commands.registerCommand('platformio-ide.serialMonitor', () =>\n        vscode.commands.executeCommand('workbench.action.tasks.runTask', {\n          type: ProjectTaskManager.type,\n          task: maybeEnvTask('Monitor'),\n        })\n      )\n    );\n  }\n\n  dispose() {\n    pioNodeHelpers.misc.disposeSubscriptions(this.subscriptions);\n  }\n}\n","/**\n * Copyright (c) 2017-present PlatformIO <contact@platformio.org>\n * All rights reserved.\n *\n * This source code is licensed under the license found in the LICENSE file in\n * the root directory of this source tree.\n */\n\nimport * as vscode from 'vscode';\n\nimport ProjectTaskManager from './project';\n\nexport default class ProjectTasksTreeProvider {\n  constructor(id, envTasks, selectedEnvName) {\n    this.id = id;\n    this.envTasks = envTasks;\n    this.selectedEnvName = selectedEnvName;\n    this.multiEnvProject =\n      Object.keys(this.envTasks).filter((env) => env.includes('env:')).length > 1;\n  }\n\n  getTreeItem(item) {\n    return item instanceof vscode.TreeItem ? item : this.taskToTreeItem(item);\n  }\n\n  taskToTreeItem(task) {\n    const treeItem = new vscode.TreeItem(task.name);\n    treeItem.iconPath = new vscode.ThemeIcon('circle-outline');\n    treeItem.tooltip = task.title;\n    treeItem.command = {\n      title: task.title,\n      command: 'workbench.action.tasks.runTask',\n      arguments: [\n        {\n          type: ProjectTaskManager.type,\n          task: task.id,\n        },\n      ],\n    };\n    if (!task.coreEnv && task.multienv && this.multiEnvProject) {\n      treeItem.label += ' All';\n    }\n    return treeItem;\n  }\n\n  getChildren(element) {\n    if (element && element.group) {\n      return this.getGroupChildren(element.group, element.env);\n    } else if (element && element.env) {\n      return this.getEnvChildren(element.env);\n    }\n    return this.getRootChildren();\n  }\n\n  getRootChildren() {\n    const result = [];\n    for (const env of Object.keys(this.envTasks)) {\n      const treeItem = new vscode.TreeItem(\n        env,\n        env === `env:${this.selectedEnvName}` ||\n        (env.includes('env:') && !this.multiEnvProject)\n          ? vscode.TreeItemCollapsibleState.Expanded\n          : vscode.TreeItemCollapsibleState.Collapsed\n      );\n      treeItem.id = `${this.id}-${env}`;\n      treeItem.env = env;\n      treeItem.iconPath = new vscode.ThemeIcon('root-folder');\n      result.push(treeItem);\n    }\n    return result;\n  }\n\n  getGroupChildren(group, env = undefined) {\n    return this.envTasks[env].filter((task) => task.group === group);\n  }\n\n  getEnvChildren(env) {\n    const envTasks = this.envTasks[env];\n    if (!envTasks.length) {\n      return [new vscode.TreeItem('Loading...')];\n    }\n    const result = envTasks.filter((task) => !task.group && !task.coreEnv);\n    // root groups\n    for (const group of this.getTaskGroups(envTasks)) {\n      const element = new vscode.TreeItem(\n        group,\n        ['General', 'Platform'].includes(group)\n          ? vscode.TreeItemCollapsibleState.Expanded\n          : vscode.TreeItemCollapsibleState.Collapsed\n      );\n      element.env = env;\n      element.group = group;\n      element.iconPath = vscode.ThemeIcon.Folder;\n      result.push(element);\n    }\n    return result;\n  }\n\n  getTaskGroups(tasks) {\n    const result = ['General'];\n    const candidates = tasks.filter((task) => task.group).map((task) => task.group);\n    // reorder\n    if (candidates.includes('Platform')) {\n      result.push('Platform');\n    }\n    for (const group of candidates) {\n      if (!result.includes(group)) {\n        result.push(group);\n      }\n    }\n    return result;\n  }\n}\n","/**\n * Copyright (c) 2017-present PlatformIO <contact@platformio.org>\n * All rights reserved.\n *\n * This source code is licensed under the license found in the LICENSE file in\n * the root directory of this source tree.\n */\n\nimport vscode from 'vscode';\n\nexport default class PIOTerminal {\n  constructor() {\n    this._instance = undefined;\n  }\n\n  new() {\n    const envClone = Object.create(process.env);\n    if (process.env.PLATFORMIO_PATH) {\n      envClone.PATH = process.env.PLATFORMIO_PATH;\n      envClone.Path = process.env.PLATFORMIO_PATH;\n    }\n    return vscode.window.createTerminal({\n      name: 'PlatformIO CLI',\n      env: envClone,\n    });\n  }\n\n  sendText(text) {\n    if (!this._instance || this._instance.exitStatus !== undefined) {\n      this._instance = this.new();\n    }\n    this._instance.sendText(text);\n    this._instance.show();\n  }\n\n  dispose() {\n    if (this._instance) {\n      this._instance.dispose();\n    }\n    this._instance = undefined;\n  }\n}\n","/**\n * Copyright (c) 2017-present PlatformIO <contact@platformio.org>\n * All rights reserved.\n *\n * This source code is licensed under the license found in the LICENSE file in\n * the root directory of this source tree.\n */\n\nimport * as pioNodeHelpers from 'platformio-node-helpers';\n\nimport os from 'os';\nimport vscode from 'vscode';\n\nexport async function notifyError(title, err) {\n  const description = err.stack || err.toString();\n  const ghbody = `# Description of problem\n  Leave a comment...\n\n  BEFORE SUBMITTING, PLEASE SEARCH FOR DUPLICATES IN\n  - https://github.com/platformio/platformio-vscode-ide/issues?q=is%3Aissue+\n\n  # Configuration\n\n  VSCode: ${vscode.version}\n  PIO IDE: v${getIDEVersion()}\n  System: ${os.type()}, ${os.release()}, ${os.arch()}\n\n  # Exception\n  \\`\\`\\`\n  ${description}\n  \\`\\`\\`\n  `;\n  const reportUrl = pioNodeHelpers.misc.getErrorReportUrl(title, ghbody);\n\n  let action = 'Report a problem';\n  if (!reportUrl.includes('issues/new')) {\n    action = 'Check available solutions';\n  }\n\n  const selected = await vscode.window.showErrorMessage(\n    description.substring(0, 700) + '...',\n    action\n  );\n  if (selected === action) {\n    vscode.commands.executeCommand('vscode.open', vscode.Uri.parse(reportUrl));\n  }\n  console.error(err);\n}\n\nexport function getIDEManifest() {\n  return vscode.extensions.getExtension('platformio.platformio-ide').packageJSON;\n}\n\nexport function getIDEVersion() {\n  return getIDEManifest().version;\n}\n","/**\n * Copyright (c) 2017-present PlatformIO <contact@platformio.org>\n * All rights reserved.\n *\n * This source code is licensed under the license found in the LICENSE file in\n * the root directory of this source tree.\n */\n\nimport * as vscode from 'vscode';\n\nclass QuickItem extends vscode.TreeItem {\n  constructor(label, command, args, collapsibleState, children) {\n    super(label, collapsibleState);\n    if (command) {\n      this.command = {\n        title: label,\n        command,\n        arguments: args,\n      };\n    }\n    this.customChildren = children;\n  }\n}\n\nexport default class QuickAccessTreeProvider {\n  getChildren(element) {\n    if (element && element.customChildren) {\n      return element.customChildren;\n    }\n    return [\n      new QuickItem(\n        'PIO Home',\n        undefined,\n        undefined,\n        vscode.TreeItemCollapsibleState.Expanded,\n        [\n          new QuickItem('Open', 'platformio-ide.showHome'),\n          new QuickItem('PIO Account', 'platformio-ide.showHome', ['/account']),\n          new QuickItem('Inspect', 'platformio-ide.showHome', ['/inspect']),\n          new QuickItem('Projects & Configuration', 'platformio-ide.showHome', [\n            '/projects',\n          ]),\n          new QuickItem('Libraries', 'platformio-ide.showHome', ['/libraries']),\n          new QuickItem('Boards', 'platformio-ide.showHome', ['/boards']),\n          new QuickItem('Platforms', 'platformio-ide.showHome', ['/platforms']),\n          new QuickItem('Devices', 'platformio-ide.showHome', ['/device']),\n        ]\n      ),\n      new QuickItem(\n        'Debug',\n        undefined,\n        undefined,\n        vscode.TreeItemCollapsibleState.Expanded,\n        [\n          new QuickItem('Start Debugging', 'platformio-ide.startDebugging'),\n          new QuickItem('Toggle Debug Console', 'workbench.debug.action.toggleRepl'),\n        ]\n      ),\n      new QuickItem(\n        'Updates',\n        undefined,\n        undefined,\n        vscode.TreeItemCollapsibleState.Expanded,\n        [\n          new QuickItem('Library Updates', 'platformio-ide.showHome', [\n            '/libraries/updates',\n          ]),\n          new QuickItem('Platform Updates', 'platformio-ide.showHome', [\n            '/platforms/updates',\n          ]),\n          new QuickItem('Update All', 'platformio-ide.updateCore'),\n        ]\n      ),\n      new QuickItem(\n        'Miscellaneous',\n        undefined,\n        undefined,\n        vscode.TreeItemCollapsibleState.Expanded,\n        [\n          new QuickItem('PlatformIO Core CLI', 'platformio-ide.openPIOCoreCLI'),\n          new QuickItem('Clone Git Project', 'git.clone'),\n          new QuickItem('New Terminal', 'platformio-ide.newTerminal'),\n          new QuickItem('Upgrade PlatformIO Core', 'platformio-ide.upgradeCore'),\n        ]\n      ),\n    ];\n  }\n\n  getTreeItem(element) {\n    return element;\n  }\n}\n","module.exports = require(\"fs\");;","module.exports = require(\"fs-plus\");;","module.exports = require(\"os\");;","module.exports = require(\"path\");;","module.exports = require(\"platformio-node-helpers\");;","module.exports = require(\"platformio-vscode-debug\");;","module.exports = require(\"vscode\");;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(939);\n"],"sourceRoot":""}